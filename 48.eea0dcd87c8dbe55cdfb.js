(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{k8QF:function(e,t,n){"use strict";n.r(t),n.d(t,"CustomersDetailsModule",function(){return T});var a=n("ofXK"),o=n("tyNb"),i=n("XNiG"),c=n("cxbk"),r=n("fXoL"),s=n("Hu2X"),l=n("Jn3s"),m=n("0mlJ");function d(e,t){if(1&e&&(r["\u0275\u0275elementStart"](0,"div",15),r["\u0275\u0275elementStart"](1,"span"),r["\u0275\u0275text"](2),r["\u0275\u0275pipe"](3,"date"),r["\u0275\u0275pipe"](4,"dateObject"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"]()),2&e){const e=r["\u0275\u0275nextContext"]();r["\u0275\u0275advance"](2),r["\u0275\u0275textInterpolate1"]("Customer since: ",r["\u0275\u0275pipeBind2"](3,1,r["\u0275\u0275pipeBind1"](4,4,e.customer.dateAssociated),"YYYY"),"")}}function p(e,t){if(1&e&&(r["\u0275\u0275elementStart"](0,"span",15),r["\u0275\u0275element"](1,"i",16),r["\u0275\u0275text"](2),r["\u0275\u0275pipe"](3,"number"),r["\u0275\u0275elementEnd"]()),2&e){const e=r["\u0275\u0275nextContext"]();r["\u0275\u0275advance"](2),r["\u0275\u0275textInterpolate1"](" R",r["\u0275\u0275pipeBind2"](3,1,e.customer.lifeTimeRevenue,"1.1-2")," lifetime revenue ")}}const u=function(e){return["/customer",e]},h=function(){return{exact:!0}},v=function(e){return["/customer",e,"contacts"]},y=function(e){return["/customer",e,"documents"]},f=function(e){return["/customer",e,"reviews"]};let b=(()=>{class e{constructor(e,t,n){this.activatedRoute=e,this.location=t,this.companyService=n,this.blobUrl=c.a.apiBlobUrl+"/256px/",this.destroy$=new i.a}ngOnInit(){this.companyConnectID=+this.activatedRoute.snapshot.params.id,this.initData()}initData(){this.loading=!0,this.companyService.getCompanyConnect(0,0,0,this.companyConnectID).subscribe(e=>{this.customer=e[0],this.companyService.storeCompanyConnectRx(this.customer),this.loading=!1})}back(){this.location.back()}ngOnDestroy(){this.destroy$.complete(),this.destroy$.next()}}return e.\u0275fac=function(t){return new(t||e)(r["\u0275\u0275directiveInject"](o.a),r["\u0275\u0275directiveInject"](a.j),r["\u0275\u0275directiveInject"](s.a))},e.\u0275cmp=r["\u0275\u0275defineComponent"]({type:e,selectors:[["app-customers-details"]],decls:30,vars:25,consts:[[1,"d-flex","flex-column","w-100",3,"avnonLoader"],[1,"page-title"],[1,"cursor-pointer","text-primary","display-inline","mr-2",3,"click"],[1,"fas","fa-long-arrow-alt-left"],[1,"display-inline"],[1,"entry","border-none"],[1,"media","avatar","avatar-48","avatar-48-square"],["alt","Avatar",1,"img-fluid","img-48",3,"src"],[1,"mt-1"],["class","meta",4,"ngIf"],[1,"profile-overview","pb-0","pt-0","mt-0","d-flex"],[1,"tabs"],[1,"nav","nav-fill","justify-content-center"],[1,"nav-item"],["routerLinkActive","active",1,"nav-link",3,"routerLink","routerLinkActiveOptions"],[1,"meta"],[1,"fas","fa-list-alt","mr-1"]],template:function(e,t){1&e&&(r["\u0275\u0275elementStart"](0,"div",0),r["\u0275\u0275elementStart"](1,"div",1),r["\u0275\u0275elementStart"](2,"span",2),r["\u0275\u0275listener"]("click",function(){return t.back()}),r["\u0275\u0275element"](3,"i",3),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](4,"h1",4),r["\u0275\u0275text"](5,"Customer Profile"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](6,"div"),r["\u0275\u0275elementStart"](7,"div",5),r["\u0275\u0275elementStart"](8,"span",6),r["\u0275\u0275element"](9,"img",7),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](10,"h2",8),r["\u0275\u0275text"](11),r["\u0275\u0275elementEnd"](),r["\u0275\u0275template"](12,d,5,6,"div",9),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](13,"div",10),r["\u0275\u0275template"](14,p,4,4,"span",9),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](15,"div",11),r["\u0275\u0275elementStart"](16,"ul",12),r["\u0275\u0275elementStart"](17,"li",13),r["\u0275\u0275elementStart"](18,"a",14),r["\u0275\u0275text"](19,"Profile"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](20,"li",13),r["\u0275\u0275elementStart"](21,"a",14),r["\u0275\u0275text"](22,"Contacts"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](23,"li",13),r["\u0275\u0275elementStart"](24,"a",14),r["\u0275\u0275text"](25,"Documents"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](26,"li",13),r["\u0275\u0275elementStart"](27,"a",14),r["\u0275\u0275text"](28,"Reviews"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275element"](29,"router-outlet"),r["\u0275\u0275elementEnd"]()),2&e&&(r["\u0275\u0275property"]("avnonLoader",t.loading),r["\u0275\u0275advance"](9),r["\u0275\u0275property"]("src",null!=t.customer&&t.customer.companyLogo?t.blobUrl+(null==t.customer?null:t.customer.companyLogo):"assets/img/card-placeholder.jpg",r["\u0275\u0275sanitizeUrl"]),r["\u0275\u0275advance"](2),r["\u0275\u0275textInterpolate"](null==t.customer?null:t.customer.companyName),r["\u0275\u0275advance"](1),r["\u0275\u0275property"]("ngIf",null==t.customer?null:t.customer.dateAssociated),r["\u0275\u0275advance"](2),r["\u0275\u0275property"]("ngIf",null==t.customer?null:t.customer.lifeTimeRevenue),r["\u0275\u0275advance"](4),r["\u0275\u0275property"]("routerLink",r["\u0275\u0275pureFunction1"](13,u,t.companyConnectID))("routerLinkActiveOptions",r["\u0275\u0275pureFunction0"](15,h)),r["\u0275\u0275advance"](3),r["\u0275\u0275property"]("routerLink",r["\u0275\u0275pureFunction1"](16,v,t.companyConnectID))("routerLinkActiveOptions",r["\u0275\u0275pureFunction0"](18,h)),r["\u0275\u0275advance"](3),r["\u0275\u0275property"]("routerLink",r["\u0275\u0275pureFunction1"](19,y,t.companyConnectID))("routerLinkActiveOptions",r["\u0275\u0275pureFunction0"](21,h)),r["\u0275\u0275advance"](3),r["\u0275\u0275property"]("routerLink",r["\u0275\u0275pureFunction1"](22,f,t.companyConnectID))("routerLinkActiveOptions",r["\u0275\u0275pureFunction0"](24,h)))},directives:[l.a,a.n,o.g,o.f,o.i],pipes:[a.e,m.a,a.f],styles:[""]}),e})(),g=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r["\u0275\u0275defineComponent"]({type:e,selectors:[["app-customer-profile"]],decls:0,vars:0,template:function(e,t){},styles:[""]}),e})(),S=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r["\u0275\u0275defineComponent"]({type:e,selectors:[["app-customer-documents"]],decls:0,vars:0,template:function(e,t){},styles:[""]}),e})();var I=n("cp0P"),C=n("LRne"),D=n("1G5W"),x=n("frau"),E=n("OzGw"),w=n("8J6U"),j=n("1kSV"),k=n("WhH8"),O=n("5eHb"),L=n("kmKP"),$=n("SdWN");function F(e,t){if(1&e){const e=r["\u0275\u0275getCurrentView"]();r["\u0275\u0275elementStart"](0,"div",5),r["\u0275\u0275elementStart"](1,"span",6),r["\u0275\u0275element"](2,"img",7),r["\u0275\u0275pipe"](3,"avatar"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](4,"div",8),r["\u0275\u0275elementStart"](5,"h2"),r["\u0275\u0275text"](6),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](7,"div",9),r["\u0275\u0275elementStart"](8,"div",10),r["\u0275\u0275elementStart"](9,"button",11),r["\u0275\u0275element"](10,"span",12),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](11,"ul",13),r["\u0275\u0275elementStart"](12,"li"),r["\u0275\u0275elementStart"](13,"a",14),r["\u0275\u0275listener"]("click",function(){r["\u0275\u0275restoreView"](e);const n=t.index;return r["\u0275\u0275nextContext"]().deleteContact(n)}),r["\u0275\u0275text"](14,"Delete"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](15,"div",15),r["\u0275\u0275elementStart"](16,"span"),r["\u0275\u0275text"](17),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit;r["\u0275\u0275advance"](2),r["\u0275\u0275property"]("src",r["\u0275\u0275pipeBind1"](3,4,e.profilePhoto),r["\u0275\u0275sanitizeUrl"]),r["\u0275\u0275advance"](4),r["\u0275\u0275textInterpolate2"]("",e.firstName," ",e.surname,""),r["\u0275\u0275advance"](11),r["\u0275\u0275textInterpolate"](e.designation)}}let R=(()=>{class e{constructor(e,t,n,a,o){this.modal=e,this.contactService=t,this.toastrService=n,this.userService=a,this.companyService=o,this.contacts=[],this.destroy$=new i.a,this.user=this.userService.user.getValue(),this.contactID=this.user.contactID}ngOnInit(){this.companyService.getCompanyConnectRx().pipe(Object(D.a)(this.destroy$)).subscribe(e=>{e&&(this.customer=e,this.initData())})}initData(){this.loading=!0,this.contactService.getContactConnect(0,0,3,0,"0",1,1e3,this.customer.companyConnectID).pipe(Object(D.a)(this.destroy$)).subscribe(e=>{this.contacts=e,this.loading=!1})}addContact(){const e=this.modal.open(x.a);e.componentInstance.allowNewContact=!0,e.componentInstance.customerContact=!0,e.componentInstance.masterCompanyID=this.customer.companyID,e.result.then(e=>{const t=e.filter(e=>0===this.contacts.filter(t=>t.contactID===e.contactID).length);this.saveContacts(t)})}saveContacts(e){const t=[];e.length&&(this.loading=!0),e.forEach(e=>{const n={contactID:e.contactID,companyID:this.customer.companyID,submittedByContactID:this.contactID,referenceID:this.customer.companyConnectID,contactConnectCategoryID:3,dateConnected:Object(w.a)(new Date),connectUntil:Object(w.a)(new Date),contactConnectDetail:"Customer Contact Connection",contactConnectStatusID:2};t.push(this.contactService.createContactConnected(n))}),(t.length?Object(I.a)(t):Object(C.a)(t)).subscribe(t=>{t.forEach(t=>{if(t.hasOwnProperty("inOut_Output")){t.contactConnectID=t.inOut_Output;const n=e.find(e=>e.contactID===t.contactID);n&&(t.firstName=n.firstName,t.surname=n.surname,t.profilePhoto=n.profilePhoto),this.contacts.push(t)}}),this.loading=!1})}deleteContact(e){const t=this.contacts[e],n=this.modal.open(E.a);n.componentInstance.objectType="Customer Contact",n.componentInstance.objectDetails=`${t.firstname} ${t.surname}`,this.contactService.deleteContactConnect(t.contactConnectID).subscribe(()=>{this.contacts.splice(e,1),this.toastrService.success("Customer contact has been deleted")})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(t){return new(t||e)(r["\u0275\u0275directiveInject"](j.p),r["\u0275\u0275directiveInject"](k.a),r["\u0275\u0275directiveInject"](O.b),r["\u0275\u0275directiveInject"](L.a),r["\u0275\u0275directiveInject"](s.a))},e.\u0275cmp=r["\u0275\u0275defineComponent"]({type:e,selectors:[["app-customer-contacts"]],decls:8,vars:3,consts:[[1,"d-flex","flex-column","w-100",3,"avnonLoader"],[1,"filter-container","d-flex","w-100","align-items-center","border-bottom"],[1,"ml-auto","cursor-pointer",3,"click"],[1,"plus-ico-2"],["class","entry",4,"ngFor","ngForOf"],[1,"entry"],[1,"media","avatar","avatar-48","avatar-48-square"],["alt","Avatar",1,"img-fluid","img-48","cover",3,"src"],[1,"d-flex"],[1,"actions"],[1,"dropdown"],["type","button","id","dd1","data-bs-toggle","dropdown","aria-expanded","false",1,"btn","btn-30"],[1,"ico","dots-ico"],["aria-labelledby","dd1",1,"dropdown-menu","dropdown-menu-end"],[1,"dropdown-item",3,"click"],[1,"meta"]],template:function(e,t){1&e&&(r["\u0275\u0275elementStart"](0,"div",0),r["\u0275\u0275elementStart"](1,"div",1),r["\u0275\u0275elementStart"](2,"span"),r["\u0275\u0275text"](3),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](4,"a",2),r["\u0275\u0275listener"]("click",function(){return t.addContact()}),r["\u0275\u0275element"](5,"span",3),r["\u0275\u0275text"](6,"Add "),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275template"](7,F,18,6,"div",4),r["\u0275\u0275elementEnd"]()),2&e&&(r["\u0275\u0275property"]("avnonLoader",t.loading),r["\u0275\u0275advance"](3),r["\u0275\u0275textInterpolate1"]("",t.contacts.length," contacts"),r["\u0275\u0275advance"](4),r["\u0275\u0275property"]("ngForOf",t.contacts))},directives:[l.a,a.m],pipes:[$.a],styles:[""]}),e})();var A=n("VgRj"),N=n("3DXX"),P=n("AytR"),B=n("SCsZ"),U=n("1bi4");function M(e,t){if(1&e&&(r["\u0275\u0275elementStart"](0,"div",6),r["\u0275\u0275elementStart"](1,"span",7),r["\u0275\u0275element"](2,"img",8),r["\u0275\u0275pipe"](3,"avatar"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](4,"div",9),r["\u0275\u0275elementStart"](5,"h2"),r["\u0275\u0275text"](6),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](7,"div",10),r["\u0275\u0275elementStart"](8,"span"),r["\u0275\u0275text"](9),r["\u0275\u0275pipe"](10,"date"),r["\u0275\u0275pipe"](11,"dateObject"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](12,"div",10),r["\u0275\u0275element"](13,"ngb-rating",11),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](14,"div",12),r["\u0275\u0275elementStart"](15,"p"),r["\u0275\u0275text"](16),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;r["\u0275\u0275advance"](2),r["\u0275\u0275property"]("src",r["\u0275\u0275pipeBind1"](3,7,e.profilePhoto),r["\u0275\u0275sanitizeUrl"]),r["\u0275\u0275advance"](4),r["\u0275\u0275textInterpolate2"]("",e.firstname," ",e.surname,""),r["\u0275\u0275advance"](3),r["\u0275\u0275textInterpolate"](r["\u0275\u0275pipeBind2"](10,9,r["\u0275\u0275pipeBind1"](11,12,e.datePosted),"dd MMM, yyyy")),r["\u0275\u0275advance"](4),r["\u0275\u0275property"]("max",4)("rate",e.sentimentRatingID),r["\u0275\u0275advance"](3),r["\u0275\u0275textInterpolate"](e.comment)}}const V=[{path:"",component:b,children:[{path:"",component:g},{path:"contacts",component:R},{path:"documents",component:S},{path:"reviews",component:(()=>{class e{constructor(e,t,n,a,o,c,r,s){this.contactService=e,this.companyService=t,this.sentimentService=n,this.modal=a,this.userService=o,this.toastrService=c,this.distributionService=r,this.activatedRoute=s,this.contacts=[],this.sentiments=[],this.blobUrl=P.a.apiBlobUrl+"/512px/",this.destroy$=new i.a,this.user=this.userService.user.getValue(),this.contactID=this.user.contactID,this.companyID=this.user.companyID}ngOnInit(){this.companyConnectID=+this.activatedRoute.parent.snapshot.params.id,this.companyService.getCompanyConnectRx().pipe(Object(D.a)(this.destroy$)).subscribe(e=>{this.customer=e}),this.getContacts(),this.getReviews(),this.getCompany()}getCompany(){this.companyLoading=!0,this.companyService.getCompanyProfile(this.companyID).pipe(Object(D.a)(this.destroy$)).subscribe(e=>{this.company=e,this.companyLoading=!1})}getContacts(){this.loading=!0,this.contactService.getContactConnect(0,0,3,0,"0",1,1e3,this.companyConnectID).pipe(Object(D.a)(this.destroy$)).subscribe(e=>{this.contacts=e,this.loading=!1})}getReviews(){this.sentimentLoading=!0,this.sentimentService.getSentiments(0,0,0,this.companyConnectID,2).subscribe(e=>{this.sentiments=e,this.sentimentLoading=!1})}selectContacts(){const e=this.modal.open(x.a);e.componentInstance.staticSelector=!0,e.componentInstance.contacts=this.contacts,e.result.then(e=>{e.length&&(e.forEach(e=>{this.sendSentiments(e)}),this.toastrService.success("Monthly Feedback has been sent"))})}sendSentiments(e){const t=this.customer,n=A.a.fullDomain()+"/customer/satisfaction/response?ref="+Object(w.n)(t.companyConnectID.toString())+"&contact="+Object(w.n)(e.contactID.toString());let a=`\n<p>Hi ${e.firstName}</p>\n<p>As part our commitment to providing high quality products and services to ${t.companyName} we've prepared a short feedback form which we'd like you to complete.</p>\n<p>Please click the button below to get started</p>\n<br>\n<p>\n<span class="btn btn-primary" style="margin: 0; padding: 0"><a href="${n}">Submit Feedback</a></span>\n</p>\n<br>\n`;this.company.companyLogo&&(a=N.a.logo(this.blobUrl+this.company.companyLogo)+a);const o={distributionTitle:"Customer Feedback",distributionCategoryID:14,referenceID:t.companyConnectID,distributionDate:null,userID:this.contactID,emailBody:N.a.template(a),subjectLine:"Customer Feedback",senderEmail:"info@incubatorportal.com",senderName:`${this.user.firstName} ${this.user.surname}`,replyTo:null,contacts:[e.contactID]};this.distributionService.create(o).subscribe(()=>{},()=>{})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(t){return new(t||e)(r["\u0275\u0275directiveInject"](k.a),r["\u0275\u0275directiveInject"](s.a),r["\u0275\u0275directiveInject"](B.a),r["\u0275\u0275directiveInject"](j.p),r["\u0275\u0275directiveInject"](L.a),r["\u0275\u0275directiveInject"](O.b),r["\u0275\u0275directiveInject"](U.a),r["\u0275\u0275directiveInject"](o.a))},e.\u0275cmp=r["\u0275\u0275defineComponent"]({type:e,selectors:[["app-customer-reviews"]],decls:8,vars:2,consts:[[3,"avnonLoader"],[1,"filter-container","d-flex","w-100","align-items-center","border-bottom","pt-3","pb-3"],[1,"mr-2"],[1,"ml-auto","cursor-pointer",3,"click"],[1,"plus-ico-2"],["class","entry",4,"ngFor","ngForOf"],[1,"entry"],[1,"media","avatar","avatar-48","avatar-48-square"],["alt","Avatar",1,"img-fluid","img-48","cover",3,"src"],[1,"d-flex"],[1,"meta"],["readonly","",3,"max","rate"],[1,"entry-content"]],template:function(e,t){1&e&&(r["\u0275\u0275elementStart"](0,"div",0),r["\u0275\u0275elementStart"](1,"div",1),r["\u0275\u0275elementStart"](2,"span",2),r["\u0275\u0275text"](3,"Select who you'd like to send the monthly customer feedback form to"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](4,"a",3),r["\u0275\u0275listener"]("click",function(){return t.selectContacts()}),r["\u0275\u0275element"](5,"span",4),r["\u0275\u0275text"](6,"Select "),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275template"](7,M,17,14,"div",5),r["\u0275\u0275elementEnd"]()),2&e&&(r["\u0275\u0275property"]("avnonLoader",t.loading||t.sentimentLoading||t.companyLoading),r["\u0275\u0275advance"](7),r["\u0275\u0275property"]("ngForOf",t.sentiments))},directives:[l.a,a.m,j.w],pipes:[$.a,a.e,m.a],styles:[""]}),e})()}]}];let X=(()=>{class e{}return e.\u0275mod=r["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=r["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[o.h.forChild(V)],o.h]}),e})();var q=n("3Pt+"),z=n("j4PG"),G=n("GKkB"),J=n("pr+S");let T=(()=>{class e{}return e.\u0275mod=r["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=r["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[a.c,X,q.l,q.z,j.q,j.l,z.a,G.a,J.a,j.x]]}),e})()}}]);